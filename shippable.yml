language: none

build:
  ci:
    - curl -L https://github.com/docker/compose/releases/download/1.8.1/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
    - chmod +x /usr/local/bin/docker-compose
    - sed -i 's|- .:/app||g' docker-compose.yml
    - docker-compose down
    - docker-compose build
    - docker-compose up -d browserstacklocal && sleep 5
    - docker-compose exec -T spring bundle install
    - docker-compose exec -T spring npm install
    - docker-compose exec -T spring bash -c "cd frontend && npm install && npm run-script build"
    - docker-compose exec -T spring bin/rails db:setup db:test:prepare
    - docker-compose exec -T spring bin/rails test

env:
  global:
    - CAPYBARA_APP_HOST=http://spring:3001
    - secure: TMXqndzX/jGO2T+RHZvtpzPb0/TuTMHY6/7rHfiRBEce2QpynN0cUfHmCgI1vyFTzW/Dx+s68H2/XV34f7CbHROXTYjfrEbYI3WVDeq7r9tiB453ZmWnnECvZJMgnplKZHmGHWv2svtgdcK1MKkgrzzyhOVs9YwnStoyZOUkZBTJBCgJtSqVDsu0A+B4ZvtVvetLm6VJ6zNuubJYywgik7DTm5arvDwE7hOZcvkZSir18oRC45MsI3K1M3weINBYGy7IlVlND2GpAG9y6aUXZIXOVm4JNtsSyCJ91Hka7gCMXyrGkYMxcWxSN4eBEPwNWwJkOtblT/7MaJanphZVmQ==
